//============================================================================//
//            G L O B A L   D E F I N I T I O N S                             //
//============================================================================//
#include "stm32f10x.h"
#include "stm32f10x_pwr.h"
#include "power.h"
#include "system.h"
#include "sdhDef.h"
//------------------------------------------------------------------------------
// const defines
//------------------------------------------------------------------------------

//------------------------------------------------------------------------------
// module global vars
//------------------------------------------------------------------------------


//------------------------------------------------------------------------------
// global function prototypes
//------------------------------------------------------------------------------

//============================================================================//
//            P R I V A T E   D E F I N I T I O N S                           //
//============================================================================//

//------------------------------------------------------------------------------
// const defines
//------------------------------------------------------------------------------
#define PWR_PIN_CODE		0xbb
//------------------------------------------------------------------------------
// local types
//------------------------------------------------------------------------------

//------------------------------------------------------------------------------
// local vars
//------------------------------------------------------------------------------


//------------------------------------------------------------------------------
// local function prototypes
//------------------------------------------------------------------------------


//============================================================================//
//            P U B L I C   F U N C T I O N S                                 //
//============================================================================//
int PVD_Init(void)
{
	
	EXTI_InitTypeDef exti_param;
	
	

	EXTI_DeInit();
	EXTI_StructInit(&exti_param);
	exti_param.EXTI_Line = EXTI_Line16; 
	exti_param.EXTI_Mode = EXTI_Mode_Interrupt; //??????
	exti_param.EXTI_Trigger = EXTI_Trigger_Rising; //电压从高下降到低于设定阀值时产生中断
	exti_param.EXTI_LineCmd = ENABLE; // ?????
	EXTI_ClearITPendingBit(EXTI_Line16);
	EXTI_Init(&exti_param); // ??
	
	PWR_PVDLevelConfig(PWR_PVDLevel_2V9); 
	PWR_PVDCmd(ENABLE);


	
//	s = PWR_GetFlagStatus(PWR_FLAG_WU);
//	s = PWR_GetFlagStatus(PWR_FLAG_SB);
//	s = PWR_GetFlagStatus(PWR_FLAG_PVDO);
	
	return RET_OK;
	
}

//extern void System_power_on(void);
void PVD_IRQHandler(void)
{

//	phn_sys.sys_flag |= SYSFLAG_POWEROFF;

//	if(phn_sys.sys_flag & SYSFLAG_POWEON)		//上过电 才认为需要保存，否则可能是假掉电
//		System_power_off();


	EXTI_ClearITPendingBit(EXTI_Line16);
}
//=========================================================================//
//                                                                         //
//          P R I V A T E   D E F I N I T I O N S                          //
//                                                                         //
//=========================================================================//
/// \name Private Functions
/// \{



